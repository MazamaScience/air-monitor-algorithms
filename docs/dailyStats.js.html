<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: dailyStats.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: dailyStats.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import moment from "moment-timezone";
import { trimDate } from "./trimDate.js";
import {
  arrayCount,
  arrayMin,
  arrayMean,
  arrayMax,
  roundAndUseNull,
  useNull,
} from "./utils.js";

/**
 * Calculate daily statistics over a time series of hourly values.
 *
 * Returns five arrays of daily values:
 * * datetime -- Date object marking the start of each day (local time)
 * * count    -- Number of valid hourly values each day
 * * min      -- Minimum value each day
 * * mean     -- Mean value each day
 * * max      -- Maximum value each day
 *
 * @param {Array.&lt;Date>} datetime - Hourly UTC timestamps.
 * @param {Array.&lt;number>} x - Array of hourly values.
 * @param {string} timezone - Olson time zone (e.g. "America/Los_Angeles").
 * @returns {object} - Object with datetime, count, min, mean, and max arrays.
 */
export function dailyStats(datetime, x, timezone) {
  // Trim to full days in the specified local timezone
  const trimmed = trimDate(datetime, x, timezone);

  // TODO: Add support for minCount valid values and partial days

    // NOTE: Return empty result if fewer than 24 aligned values
  if (
    !Array.isArray(trimmed.datetime) ||
    trimmed.datetime.length &lt; 24 ||
    trimmed.datetime.length !== trimmed.x.length
  ) {
    return {
      datetime: [],
      count: [],
      min: [],
      mean: [],
      max: [],
    };
  }

  const dayCount = trimmed.datetime.length / 24;

  const dailyDatetime = [];
  const dailyCount = [];
  const dailyMin = [];
  const dailyMean = [];
  const dailyMax = [];

  for (let i = 0; i &lt; dayCount; i++) {
    const start = i * 24;
    const end = start + 24;

    // Each dayâ€™s timestamp is the first hour of the day
    dailyDatetime[i] = trimmed.datetime[start];

    // Daily stats are calculated using 24 hourly values
    const values = trimmed.x.slice(start, end);
    dailyCount[i] = arrayCount(values);
    dailyMin[i] = arrayMin(values);
    dailyMean[i] = arrayMean(values);
    dailyMax[i] = arrayMax(values);
  }

  // Round all values (0 decimals for count, 1 for everything else)
  const roundedCount = roundAndUseNull(dailyCount, 0);
  const roundedMin = roundAndUseNull(dailyMin);
  const roundedMean = roundAndUseNull(dailyMean);
  const roundedMax = roundAndUseNull(dailyMax);

  return {
    datetime: dailyDatetime,
    count: roundedCount,
    min: roundedMin,
    mean: roundedMean,
    max: roundedMax,
  };
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#arrayCount">arrayCount</a></li><li><a href="global.html#arrayMax">arrayMax</a></li><li><a href="global.html#arrayMean">arrayMean</a></li><li><a href="global.html#arrayMin">arrayMin</a></li><li><a href="global.html#arraySum">arraySum</a></li><li><a href="global.html#dailyStats">dailyStats</a></li><li><a href="global.html#diurnalStats">diurnalStats</a></li><li><a href="global.html#pm_nowcast">pm_nowcast</a></li><li><a href="global.html#roundAndUseNull">roundAndUseNull</a></li><li><a href="global.html#trimDate">trimDate</a></li><li><a href="global.html#useNull">useNull</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.3</a> on Wed Jun 18 2025 14:27:15 GMT-0700 (Pacific Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
